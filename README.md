[TOC]

# 更新列表

## V1.02.01

1、修改了清晰度算法的实现思路，采用canny算子得到的边缘，与其本身骨架化后的面积进行对比，越清晰，则比率越接近1
2、修改了血管提取的动态阈值参数，使提取出的区域分离度更高
3、修改了流速计算方案，详参代码calculate_flowrate函数
4、集成了糖萼算法
5、改版了数据分析界面，使算法数据更加集中直观
6、相机动态库在V200项目中进行了优化

## V1.02.02

0、加入了数据库 记录视频信息和血管信息
1、优化了清晰度算法和血管区域分解算法的稳定性
2、优化了防抖算法 加入了对首帧清晰度的处理 关联到流速算法中的跳帧流动面积计算准确度
3、优化了导入视频文件路径的不可重复性
4、修正了导出csv文件中的糖萼平均值计算方法
5、修改了详细数据页面的进入方式 由原来的双击改为回车进入
6、增加了记录图像计算状态的功能，重新进入软件后可以自动开始计算

7、修正糖萼参数的计算

8、增加视频不存在或已损坏的提示

## V1.02.03
### 针对实时图像判断
1、为了适配大分辨率和高帧率实时图像质量判断 实现了异步的清晰度计算线程
2、自动录制的定时时长提高到1.1s 避免录制出的视频时长低于1s
3、录制完成后 在视频列表显示实际的秒数时长

## V1.03.01
### 算法部分
1、修复了防抖区域对齐算法 当血管区域较为集中在图中某一区域时 对齐后的血管区域会产生缺失的问题
2、修改了糖萼算法的获取中心线角度方法 配手动更新的血管无法调用get_contour_angle_xld算子的情况
    3.1、修改了糖萼计算的Qt接口 新增了是否手动刷新数据的判断 新增了"手动"和直接"参数
3、图像算法Qt接口 新增了reCalculateAll接口 提供给血管描记后重新计算血管信息和算法数据调用

### 界面部分
1、优化了加载历史视频记录的操作 在软件启动完成后再进行
2、数据库接口 新增了更新血管信息的接口 提供给血管描记完毕后调用
3、更改了数据分析界面的血管区域显示方案 弃用QGraphics系列 改用普通的QWidget+QPainter
4、添加了血管描记界面 描绘和擦除沿用QWidget+QPainter+QMouseEvent 点击保存时自动调用 4/6的接口进行更新并保存
5、修改了加载血管点的方法 直接使用QPainter的drawPoints方法描绘血管点
6、修改了描绘时补点的方法 使用QLineF的percent方法获取线上的各点坐标
7、增加了血管编辑功能，手动增加/删除/擦除部分血管后，重新保存更新可以刷新对应血管的微循环或算法数据
8、打包脚本中漏了数据库驱动
9、fix bug 高分辨率相机的自动录制没有等待上一个视频释放
10、fix bug 血管中心线数量为0时分割算法会崩
11、增加了自动录制的剩余录制数量提醒
12、fix bug 修复了相机动态库的AVT部分，初次读取配置文件时帧率没有设置为100

## V1.03.02
1、增加了导出数据完成后，询问是否打开csv文件
2、增加了编辑完成血管后，保存更新时可强制退出数据分析界面，不会保留编辑后的数据
3、fix bug 数据刷新线程使用引用映射到数据分析界面的成员变量，在保存时强制关闭数据分析界面会导致因成员变量释放而导致线程崩溃
4、fix bug 在数据分析界面，用左/右键点击选择血管，有可能选不到较小的血管，已修复
5、完善导出数据的格式
6、程序图标

## V1.03.03
1、针对整体分辨率，优化了**血管区域提取算法**和**清晰度算法**，采取先统一将图像缩放至(480, 480)和(640, 640)再进行提取和计算，提取完成后需要将血管区域缩放回与原分辨率匹配。
	1.1 针对(480, 480)分辨率修改了部分参数，包括血管提取[动态阈值/噪音判定面积/闭运算半径]
	1.2 修改了清晰度的判断范围

2、还原了流速算法的某个*由于编不出原理而详细设计评审不通过*的前版本。

3、界面上的*清晰度/是否清晰*参数更改为*图像综合质量*，由*亮度/持续时间/对焦(原清晰度)/内容(血管密度)/稳定性*五个参数综合计算

* 亮度：字面意思
* 持续时间：清晰（对焦成功）的持续时间是否足够1s
* 对焦：清晰度
* 内容：血管密度
* 稳定性：持续清晰的1s中，是否每帧的内容位移小于25%

4、优化自动录制功能，由原来的满足自动录制条件后才开始采集录制，改为在采集过程中保持缓存图像，在满足自动录制条件后，将缓存图像保存为视频


## 潜在问题：
1、由于新版相机高分辨率高帧率，如果使用配置较低的电脑，且同时启动2个或以上的算法处理线程，很容易采集触发不稳定(俗称掉线)的问题
2、算法准确度还存在优化空间